{% extends 'base.html' %}

{% block content %}
<style>
    .createmeetup {
        background-color: white;
        filter: drop-shadow(0px 1px 12px rgba(0, 0, 0, 0.25));
        border-radius: 20px;
        height: 40px;
    }
</style>

    <h1>Get Your Location</h1>
    
    <!-- Explicit user consent before enabling location button -->
    <input type="checkbox" id="consentCheckbox"> I allow this site to use my location.
    <br>
    <button id="getLocationBtn" disabled>Get Location</button>
    
    <p id="status">Click the button to get your location.</p>
    <p id="location"></p>
    <p id="address"></p>

    <script>
        document.getElementById("consentCheckbox").addEventListener("change", function() {
            document.getElementById("getLocationBtn").disabled = !this.checked;
        });

        document.getElementById("getLocationBtn").addEventListener("click", function () {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;

                        // Display Latitude & Longitude
                        document.getElementById("status").textContent = "Location received!";
                        document.getElementById("location").textContent = `Latitude: ${latitude}, Longitude: ${longitude}`;

                        // Call Reverse Geocoding API to get the address
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`)  // Backend proxy to avoid CORS and rate limits
                            .then(response => response.json())
                            .then(data => {
                                if (data.display_name) {
                                    document.getElementById("address").textContent = `Address: ${data.display_name}`;
                                } else {
                                    document.getElementById("address").textContent = "Address not found.";
                                }
                            })
                            .catch(error => {
                                console.error("Error fetching address:", error);
                                document.getElementById("address").textContent = "Error getting address.";
                            });
                    },
                    (error) => {
                        console.error("Geolocation error:", error);
                        document.getElementById("status").textContent = "Error getting location!";
                    }
                );
            } else {
                document.getElementById("status").textContent = "Geolocation is not supported.";
            }
        });
    </script>

    <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://urri-meetups.rb.dcu.ie/&amp;size=100x100" alt="QR Code" title="QR Code" />
{% endblock %}
